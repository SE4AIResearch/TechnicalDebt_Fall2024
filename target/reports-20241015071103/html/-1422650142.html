<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>3484</td> <td>-1422650142</td><td>apache/camel</td><td>Christian Schneider</td><td>709aabc94c10f929309bfac013a6d1cc1431eebd</td> <td>None</td> <td>maybe this project is camel-core itself</td> <td>SATD_ADDED</td> <td>execute()</td> <td>public void execute() throws MojoExecutionException, MojoFailureException</td> <td>
    File camelMetaDir = new File(outDir, "META-INF/services/org/apache/camel/");
    Map<String, String> javaTypes = new HashMap<String, String>();
    StringBuilder buffer = new StringBuilder();
    int count = 0;
    for (Resource r : project.getBuild().getResources()) {
        File f = new File(r.getDirectory());
        if (!f.exists()) {
            f = new File(project.getBasedir(), r.getDirectory());
        }
        f = new File(f, "META-INF/services/org/apache/camel/language");
        if (f.exists() && f.isDirectory()) {
            File[] files = f.listFiles();
            if (files != null) {
                for (File file : files) {
                    String name = file.getName();
                    if (name.charAt(0) != '.') {
                        count++;
                        if (buffer.length() > 0) {
                            buffer.append(" ");
                        }
                        buffer.append(name);
                    }
                    // find out the javaType for each data format
                    try {
                        String text = loadText(new FileInputStream(file));
                        Map<String, String> map = parseAsMap(text);
                        String javaType = map.get("class");
                        if (javaType != null) {
                            javaTypes.put(name, javaType);
                        }
                    } catch (IOException e) {
                        throw new MojoExecutionException("Failed to read file " + file + ". Reason: " + e, e);
                    }
                }
            }
        }
    }
    // find camel-core and grab the data format model from there, and enrich this model with information from this artifact
    // and create json schema model file for this data format
    try {
        Artifact camelCore = findCamelCoreArtifact(project);
        if (camelCore != null) {
            File core = camelCore.getFile();
            if (core != null) {
                URL url = new URL("file", null, core.getAbsolutePath());
                URLClassLoader loader = new URLClassLoader(new URL[] { url });
                for (Map.Entry<String, String> entry : javaTypes.entrySet()) {
                    String name = entry.getKey();
                    String javaType = entry.getValue();
                    String modelName = asModelName(name);
                    InputStream is = loader.getResourceAsStream("org/apache/camel/model/language/" + modelName + ".json");
                    if (is == null) {
                        // use file input stream if we build camel-core itself, and thus do not have a JAR which can be loaded by URLClassLoader
                        is = new FileInputStream(new File(core, "org/apache/camel/model/language/" + modelName + ".json"));
                    }
                    String json = loadText(is);
                    if (json != null) {
                        LanguageModel languageModel = new LanguageModel();
                        languageModel.setName(name);
                        languageModel.setModelName(modelName);
                        languageModel.setLabel("");
                        languageModel.setDescription(project.getDescription());
                        languageModel.setJavaType(javaType);
                        languageModel.setGroupId(project.getGroupId());
                        languageModel.setArtifactId(project.getArtifactId());
                        languageModel.setVersion(project.getVersion());
                        List<Map<String, String>> rows = JSonSchemaHelper.parseJsonSchema("model", json, false);
                        for (Map<String, String> row : rows) {
                            if (row.containsKey("label")) {
                                languageModel.setLabel(row.get("label"));
                            }
                            if (row.containsKey("javaType")) {
                                languageModel.setModelJavaType(row.get("javaType"));
                            }
                            // override description for camel-core, as otherwise its too generic
                            if ("camel-core".equals(project.getArtifactId())) {
                                if (row.containsKey("description")) {
                                    languageModel.setLabel(row.get("description"));
                                }
                            }
                        }
                        getLog().debug("Model " + languageModel);
                        // build json schema for the data format
                        String properties = after(json, "  \"properties\": {");
                        String schema = createParameterJsonSchema(languageModel, properties);
                        getLog().debug("JSon schema\n" + schema);
                        // write this to the directory
                        File dir = new File(schemaOutDir, schemaSubDirectory(languageModel.getJavaType()));
                        dir.mkdirs();
                        File out = new File(dir, name + ".json");
                        FileOutputStream fos = new FileOutputStream(out, false);
                        fos.write(schema.getBytes());
                        fos.close();
                        getLog().info("Generated " + out + " containing JSon schema for " + name + " language");
                    }
                }
            }
        }
    } catch (Exception e) {
        throw new MojoExecutionException("Error loading language model from camel-core. Reason: " + e, e);
    }
    if (count > 0) {
        Properties properties = new Properties();
        String names = buffer.toString();
        properties.put("languages", names);
        properties.put("groupId", project.getGroupId());
        properties.put("artifactId", project.getArtifactId());
        properties.put("version", project.getVersion());
        properties.put("projectName", project.getName());
        properties.put("projectDescription", project.getDescription());
        camelMetaDir.mkdirs();
        File outFile = new File(camelMetaDir, "language.properties");
        try {
            properties.store(new FileWriter(outFile), "Generated by camel-package-maven-plugin");
            getLog().info("Generated " + outFile + " containing " + count + " Camel " + (count > 1 ? "languages: " : "language: ") + names);
            if (projectHelper != null) {
                List<String> includes = new ArrayList<String>();
                includes.add("**/language.properties");
                projectHelper.addResource(this.project, outDir.getPath(), includes, new ArrayList<String>());
                projectHelper.attachArtifact(this.project, "properties", "camelLanguage", outFile);
            }
        } catch (IOException e) {
            throw new MojoExecutionException("Failed to write properties to " + outFile + ". Reason: " + e, e);
        }
    } else {
        getLog().debug("No META-INF/services/org/apache/camel/language directory found. Are you sure you have created a Camel language?");
    }
</td> </tr></table></body></html>