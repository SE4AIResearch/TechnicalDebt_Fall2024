<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>5478</td> <td>-1009652248</td><td>apache/hadoop</td><td>Eli Collins</td><td>a196766ea07775f18ded69bd9e8d239f8cfd3ccc</td> <td>None</td> <td>create Configs.SYSTEM_DIR's parent with restrictive permissions.
So long as the JT has access to the system dir itself it should
be able to start.</td> <td>SATD_ADDED</td> <td>testGarbledMapredSystemDir()</td> <td>public void testGarbledMapredSystemDir() throws Exception</td> <td>
    Configuration conf = new Configuration();
    final MiniDFSCluster dfs = new MiniDFSCluster(conf, 1, true, null);
    MiniMRCluster mr = null;
    try {
        // start dfs
        conf.set("dfs.permissions.supergroup", "supergroup");
        FileSystem fs = DFS_UGI.doAs(new PrivilegedExceptionAction<FileSystem>() {

            public FileSystem run() throws IOException {
                return dfs.getFileSystem();
            }
        });
        // create Configs.SYSTEM_DIR's parent with restrictive permissions.
        // So long as the JT has access to the system dir itself it should
        // be able to start.
        Path mapredSysDir = new Path(conf.get(JTConfig.JT_SYSTEM_DIR));
        Path parentDir = mapredSysDir.getParent();
        fs.mkdirs(parentDir);
        fs.setPermission(parentDir, new FsPermission(SYSTEM_DIR_PARENT_PERMISSION));
        fs.mkdirs(mapredSysDir);
        fs.setPermission(mapredSysDir, new FsPermission(SYSTEM_DIR_PERMISSION));
        fs.setOwner(mapredSysDir, "mr", "mrgroup");
        // start mr (i.e jobtracker)
        Configuration mrConf = new Configuration(conf);
        mr = new MiniMRCluster(0, 0, 0, dfs.getFileSystem().getUri().toString(), 1, null, null, MR_UGI, new JobConf(mrConf));
        JobTracker jobtracker = mr.getJobTrackerRunner().getJobTracker();
        // add garbage to Configs.SYSTEM_DIR
        Path garbage = new Path(jobtracker.getSystemDir(), "garbage");
        fs.mkdirs(garbage);
        fs.setPermission(garbage, new FsPermission(SYSTEM_DIR_PERMISSION));
        fs.setOwner(garbage, "test", "test-group");
        // stop the jobtracker
        mr.stopJobTracker();
        mr.getJobTrackerConf().setBoolean(JTConfig.JT_RESTART_ENABLED, false);
        // start jobtracker but dont wait for it to be up
        mr.startJobTracker(false);
        // check 5 times .. each time wait for 2 secs to check if the jobtracker
        // has crashed or not.
        for (int i = 0; i < 5; ++i) {
            LOG.info("Check #" + i);
            if (!mr.getJobTrackerRunner().isActive()) {
                return;
            }
            UtilsForTests.waitFor(2000);
        }
        assertFalse("JobTracker did not bail out (waited for 10 secs)", mr.getJobTrackerRunner().isActive());
    } finally {
        if (dfs != null) {
            dfs.shutdown();
        }
        if (mr != null) {
            mr.shutdown();
        }
    }
</td> </tr></table></body></html>