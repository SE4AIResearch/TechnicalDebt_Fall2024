<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>4892</td> <td>1242678112</td><td>GerritCodeReview/gerrit</td><td>Edwin Kempin</td><td>bc8006f7e84746b9d56810744dc91af7f3bb77b3</td> <td>None</td> <td>TODO(dborowitz): ResourceConflictException.</td> <td>SATD_ADDED</td> <td>deleteDraftChange(Change)</td> <td>public void deleteDraftChange(Change change) throws NoSuchChangeException, OrmException, IOException</td> <td>
    ReviewDb db = this.db.get();
    Change.Id changeId = change.getId();
    if (change.getStatus() != Change.Status.DRAFT) {
        // TODO(dborowitz): ResourceConflictException.
        throw new NoSuchChangeException(changeId);
    }
    List<PatchSet> patchSets = db.patchSets().byChange(changeId).toList();
    for (PatchSet ps : patchSets) {
        if (!ps.isDraft()) {
            // TODO(dborowitz): ResourceConflictException.
            throw new NoSuchChangeException(changeId);
        }
        db.accountPatchReviews().delete(db.accountPatchReviews().byPatchSet(ps.getId()));
    }
    // No need to delete from notedb; draft patch sets will be filtered out.
    db.patchComments().delete(db.patchComments().byChange(changeId));
    db.patchSetApprovals().delete(db.patchSetApprovals().byChange(changeId));
    db.patchSets().delete(patchSets);
    db.changeMessages().delete(db.changeMessages().byChange(changeId));
    starredChangesUtil.unstarAll(changeId);
    db.changes().delete(Collections.singleton(change));
    // Delete all refs at once.
    try (Repository repo = gitManager.openRepository(change.getProject());
        RevWalk rw = new RevWalk(repo)) {
        String prefix = new PatchSet.Id(changeId, 1).toRefName();
        prefix = prefix.substring(0, prefix.length() - 1);
        BatchRefUpdate ru = repo.getRefDatabase().newBatchUpdate();
        for (Ref ref : repo.getRefDatabase().getRefs(prefix).values()) {
            ru.addCommand(new ReceiveCommand(ref.getObjectId(), ObjectId.zeroId(), ref.getName()));
        }
        ru.execute(rw, NullProgressMonitor.INSTANCE);
        for (ReceiveCommand cmd : ru.getCommands()) {
            if (cmd.getResult() != ReceiveCommand.Result.OK) {
                throw new IOException("failed: " + cmd + ": " + cmd.getResult());
            }
        }
    }
</td> </tr></table></body></html>