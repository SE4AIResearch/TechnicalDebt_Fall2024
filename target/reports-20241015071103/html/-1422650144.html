<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>3481</td> <td>-1422650144</td><td>apache/camel</td><td>Claus Ibsen</td><td>616d51264459971b17ce669a85b77fecd9b2237d</td> <td>None</td> <td>maybe this project is camel-core itself</td> <td>SATD_ADDED</td> <td>execute()</td> <td>public void execute() throws MojoExecutionException, MojoFailureException</td> <td>
    File camelMetaDir = new File(outDir, "META-INF/services/org/apache/camel/");
    Map<String, String> javaTypes = new HashMap<String, String>();
    StringBuilder buffer = new StringBuilder();
    int count = 0;
    for (Resource r : project.getBuild().getResources()) {
        File f = new File(r.getDirectory());
        if (!f.exists()) {
            f = new File(project.getBasedir(), r.getDirectory());
        }
        f = new File(f, "META-INF/services/org/apache/camel/dataformat");
        if (f.exists() && f.isDirectory()) {
            File[] files = f.listFiles();
            if (files != null) {
                for (File file : files) {
                    String name = file.getName();
                    if (name.charAt(0) != '.') {
                        count++;
                        if (buffer.length() > 0) {
                            buffer.append(" ");
                        }
                        buffer.append(name);
                    }
                    // find out the javaType for each data format
                    try {
                        String text = loadText(new FileInputStream(file));
                        Map<String, String> map = parseAsMap(text);
                        String javaType = map.get("class");
                        if (javaType != null) {
                            javaTypes.put(name, javaType);
                        }
                    } catch (IOException e) {
                        throw new MojoExecutionException("Failed to read file " + file + ". Reason: " + e, e);
                    }
                }
            }
        }
    }
    // find camel-core and grab the data format model from there, and enrich this model with information from this artifact
    // and create json schema model file for this data format
    try {
        Artifact camelCore = findCamelCoreArtifact(project);
        if (camelCore != null) {
            File core = camelCore.getFile();
            if (core != null) {
                URL url = new URL("file", null, core.getAbsolutePath());
                URLClassLoader loader = new URLClassLoader(new URL[] { url });
                for (String name : javaTypes.keySet()) {
                    InputStream is = loader.getResourceAsStream("org/apache/camel/model/dataformat/" + name + ".json");
                    if (is != null) {
                        String json = loadText(is);
                        if (json != null) {
                            DataFormatModel dataFormatModel = new DataFormatModel();
                            dataFormatModel.setName(name);
                            dataFormatModel.setDescription(project.getDescription());
                            dataFormatModel.setJavaType(javaTypes.get(name));
                            dataFormatModel.setGroupId(project.getGroupId());
                            dataFormatModel.setArtifactId(project.getArtifactId());
                            dataFormatModel.setVersion(project.getVersion());
                            List<Map<String, String>> rows = JSonSchemaHelper.parseJsonSchema("model", json, false);
                            for (Map<String, String> row : rows) {
                                if (row.containsKey("label")) {
                                    dataFormatModel.setLabel(row.get("label"));
                                } else {
                                    dataFormatModel.setLabel("");
                                }
                            }
                            getLog().debug("Model " + dataFormatModel);
                            // build json schema for the data format
                            String properties = after(json, "  \"properties\": {");
                            String schema = createParameterJsonSchema(dataFormatModel, properties);
                            getLog().debug("JSon schema\n" + schema);
                            // write this to the directory
                            File dir = new File(schemaOutDir, schemaSubDirectory(dataFormatModel.getJavaType()));
                            dir.mkdirs();
                            File out = new File(dir, name + ".json");
                            FileOutputStream fos = new FileOutputStream(out, false);
                            fos.write(schema.getBytes());
                            fos.close();
                            getLog().info("Generated " + out + " containing JSon schema for " + name + " data format");
                        }
                    }
                }
            }
        }
    } catch (Exception e) {
        throw new MojoExecutionException("Error loading data formation model from camel-core. Reason: " + e, e);
    }
    if (count > 0) {
        Properties properties = new Properties();
        String names = buffer.toString();
        properties.put("dataFormats", names);
        properties.put("groupId", project.getGroupId());
        properties.put("artifactId", project.getArtifactId());
        properties.put("version", project.getVersion());
        properties.put("projectName", project.getName());
        properties.put("projectDescription", project.getDescription());
        camelMetaDir.mkdirs();
        File outFile = new File(camelMetaDir, "dataformat.properties");
        try {
            properties.store(new FileWriter(outFile), "Generated by camel-package-maven-plugin");
            getLog().info("Generated " + outFile + " containing " + count + " Camel " + (count > 1 ? "dataformats: " : "dataformat: ") + names);
            if (projectHelper != null) {
                List<String> includes = new ArrayList<String>();
                includes.add("**/dataformat.properties");
                projectHelper.addResource(this.project, outDir.getPath(), includes, new ArrayList<String>());
                projectHelper.attachArtifact(this.project, "properties", "camelDataFormat", outFile);
            }
        } catch (IOException e) {
            throw new MojoExecutionException("Failed to write properties to " + outFile + ". Reason: " + e, e);
        }
    } else {
        getLog().debug("No META-INF/services/org/apache/camel/dataformat directory found. Are you sure you have created a Camel data format?");
    }
</td> </tr></table></body></html>