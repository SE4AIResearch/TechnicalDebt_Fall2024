<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>4962</td> <td>1242678147</td><td>GerritCodeReview/gerrit</td><td>Dave Borowitz</td><td>01d4110dad2c2a9e5fdf2a9edb0343171b1d922f</td> <td>None</td> <td>TODO: Use InternalUser instead of change owner</td> <td>SATD_ADDED</td> <td>abandonAllOpenChangeForDeletedProject(Project.NameKey)</td> <td>private void abandonAllOpenChangeForDeletedProject(Project.NameKey destProject)</td> <td>
    try {
        for (ChangeData cd : internalChangeQuery.byProjectOpen(destProject)) {
            // TODO: Use InternalUser instead of change owner
            try (BatchUpdate bu = batchUpdateFactory.create(db, destProject, identifiedUserFactory.create(cd.change().getOwner()), TimeUtil.nowTs())) {
                bu.addOp(cd.getId(), new BatchUpdate.Op() {

                    @Override
                    public boolean updateChange(ChangeContext ctx) throws OrmException {
                        Change change = ctx.getChange();
                        if (!change.getStatus().isOpen()) {
                            return false;
                        }
                        change.setStatus(Change.Status.ABANDONED);
                        ChangeMessage msg = new ChangeMessage(new ChangeMessage.Key(change.getId(), ChangeUtil.messageUUID(ctx.getDb())), null, change.getLastUpdatedOn(), change.currentPatchSetId());
                        msg.setMessage("Project was deleted.");
                        cmUtil.addChangeMessage(ctx.getDb(), ctx.getUpdate(change.currentPatchSetId()), msg);
                        ctx.saveChange();
                        return true;
                    }
                });
                try {
                    bu.execute();
                } catch (UpdateException | RestApiException e) {
                    logWarn("Cannot abandon changes for deleted project " + destProject, e);
                }
            }
        }
    } catch (OrmException e) {
        logWarn("Cannot abandon changes for deleted project " + destProject, e);
    }
</td> </tr></table></body></html>