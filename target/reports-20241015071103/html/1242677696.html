<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>4070</td> <td>1242677696</td><td>GerritCodeReview/gerrit</td><td>Shawn O. Pearce</td><td>3d17dbd307034ee21e36b95bd4da1d39e2ad7da8</td> <td>None</td> <td>Missing a trailing LF? Correct it (perhaps the editor was broken).</td> <td>SATD_ADDED</td> <td>writeCherryPickCommit(Merger, CodeReviewCommit)</td> <td>private void writeCherryPickCommit(final Merger m, final CodeReviewCommit n) throws IOException</td> <td>
    final StringBuilder msgbuf = new StringBuilder();
    msgbuf.append(n.getFullMessage());
    if (msgbuf.length() == 0) {
        // WTF, an empty commit message?
        msgbuf.append("<no commit message provided>");
    }
    if (msgbuf.charAt(msgbuf.length() - 1) != '\n') {
        // Missing a trailing LF? Correct it (perhaps the editor was broken).
        msgbuf.append('\n');
    }
    if (!msgbuf.toString().matches("^(\n|.)*\n[A-Za-z0-9-]{1,}: [^\n]{1,}\n$")) {
        // Doesn't end in a "Signed-off-by: ..." style line? Add another line
        // break to start a new paragraph for the reviewed-by tag lines.
        // 
        msgbuf.append('\n');
    }
    if (server.getCanonicalURL() != null) {
        msgbuf.append("Reviewed-on: ");
        msgbuf.append(server.getCanonicalURL());
        msgbuf.append(n.patchsetId.getParentKey().get());
        msgbuf.append('\n');
    }
    ChangeApproval submitAudit = null;
    try {
        final List<ChangeApproval> approvalList = schema.changeApprovals().byChange(n.patchsetId.getParentKey()).toList();
        Collections.sort(approvalList, new Comparator<ChangeApproval>() {

            public int compare(final ChangeApproval a, final ChangeApproval b) {
                return a.getGranted().compareTo(b.getGranted());
            }
        });
        for (final ChangeApproval a : approvalList) {
            if (a.getValue() <= 0) {
                // Negative votes aren't counted.
                continue;
            }
            if (ApprovalCategory.SUBMIT.equals(a.getCategoryId())) {
                // Submit is treated specially, below (becomes committer)
                // 
                if (submitAudit == null || a.getGranted().compareTo(submitAudit.getGranted()) > 0) {
                    submitAudit = a;
                }
                continue;
            }
            final Account acc = Common.getAccountCache().get(a.getAccountId());
            if (acc == null) {
                // No record of user, WTF?
                continue;
            }
            final StringBuilder identbuf = new StringBuilder();
            if (acc.getFullName() != null && acc.getFullName().length() > 0) {
                identbuf.append(' ');
                identbuf.append(acc.getFullName());
            }
            if (acc.getPreferredEmail() != null && acc.getPreferredEmail().length() > 0) {
                identbuf.append(' ');
                identbuf.append('<');
                identbuf.append(acc.getPreferredEmail());
                identbuf.append('>');
            }
            if (identbuf.length() == 0) {
                // Nothing reasonable to describe them by? Ignore them.
                continue;
            }
            final String tag;
            if (CRVW.equals(a.getCategoryId())) {
                tag = "Reviewed-by";
            } else if (VRIF.equals(a.getCategoryId())) {
                tag = "Verified-by";
            } else {
                final ApprovalType at = Common.getGerritConfig().getApprovalType(a.getCategoryId());
                if (at == null) {
                    // A deprecated/deleted approval type, ignore it.
                    continue;
                }
                tag = at.getCategory().getName().replace(' ', '-');
            }
            msgbuf.append(tag);
            msgbuf.append(':');
            msgbuf.append(identbuf);
            msgbuf.append('\n');
        }
    } catch (OrmException e) {
        log.error("Can't read approval records for " + n.patchsetId, e);
    }
    Account submitterAcct = null;
    if (submitAudit != null) {
        submitterAcct = Common.getAccountCache().get(submitAudit.getAccountId());
    }
    final Commit mergeCommit = new Commit(db);
    mergeCommit.setTreeId(m.getResultTreeId());
    mergeCommit.setParentIds(new ObjectId[] { mergeTip });
    mergeCommit.setAuthor(n.getAuthorIdent());
    if (submitterAcct != null) {
        String name = submitterAcct.getFullName();
        if (name == null || name.length() == 0) {
            name = "Anonymous Coward";
        }
        String email = submitterAcct.getPreferredEmail();
        if (email == null || email.length() == 0) {
            email = "account-" + submitterAcct.getId().get() + "@localhost";
        }
        mergeCommit.setCommitter(new PersonIdent(name, email, submitAudit.getGranted(), myIdent.getTimeZone()));
    } else {
        mergeCommit.setCommitter(myIdent);
    }
    mergeCommit.setMessage(msgbuf.toString());
    final ObjectId id = m.getObjectWriter().writeCommit(mergeCommit);
    mergeTip = (CodeReviewCommit) rw.parseCommit(id);
    n.statusCode = CommitMergeStatus.CLEAN_PICK;
    status.put(n.patchsetId.getParentKey(), n.statusCode);
    newCommits.put(n.patchsetId.getParentKey(), mergeTip);
</td> </tr></table></body></html>