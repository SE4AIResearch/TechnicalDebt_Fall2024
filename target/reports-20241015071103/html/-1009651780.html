<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>5988</td> <td>-1009651780</td><td>apache/hadoop</td><td>Steve Loughran</td><td>28e6a4e44a3e920dcaf858f9a74a6358226b3a63</td> <td>None</td> <td>Calling recover should move it aside</td> <td>SATD_ADDED</td> <td>testLogGroupRecoveryInProgress()</td> <td>public void testLogGroupRecoveryInProgress() throws IOException</td> <td>
    String[] paths = new String[] { "/foo1/current/" + getInProgressEditsFileName(123), "/foo2/current/" + getInProgressEditsFileName(123), "/foo3/current/" + getInProgressEditsFileName(123) };
    FSImageTransactionalStorageInspector inspector = new FSImageTransactionalStorageInspector();
    inspector.inspectDirectory(mockDirectoryWithEditLogs(paths[0]));
    inspector.inspectDirectory(mockDirectoryWithEditLogs(paths[1]));
    inspector.inspectDirectory(mockDirectoryWithEditLogs(paths[2]));
    // Inject spies to return the valid counts we would like to see
    mockLogValidation(inspector, paths[0], 2000);
    mockLogValidation(inspector, paths[1], 2000);
    mockLogValidation(inspector, paths[2], 1000);
    LogGroup lg = inspector.logGroups.get(123L);
    assertEquals(3, lg.logs.size());
    lg.planRecovery();
    // Check that the short one was marked corrupt
    assertFalse(lg.logs.get(0).isCorrupt());
    assertFalse(lg.logs.get(1).isCorrupt());
    assertTrue(lg.logs.get(2).isCorrupt());
    // Calling recover should move it aside
    FoundEditLog badLog = lg.logs.get(2);
    Mockito.doNothing().when(badLog).moveAsideCorruptFile();
    Mockito.doNothing().when(lg.logs.get(0)).finalizeLog();
    Mockito.doNothing().when(lg.logs.get(1)).finalizeLog();
    lg.recover();
    Mockito.verify(badLog).moveAsideCorruptFile();
    Mockito.verify(lg.logs.get(0)).finalizeLog();
    Mockito.verify(lg.logs.get(1)).finalizeLog();
</td> </tr></table></body></html>