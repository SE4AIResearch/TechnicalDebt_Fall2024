<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>4355</td> <td>1242677838</td><td>GerritCodeReview/gerrit</td><td>Jason Tsay</td><td>2c18a8882393c1603aba65fad21d5bd84e906e4d</td> <td>None</td> <td>Does not account for draft status as a user might want to let a
reviewer see a draft.</td> <td>SATD_ADDED</td> <td>call()</td> <td>public ReviewerResult call() throws Exception</td> <td>
    final Set<Account.Id> reviewerIds = new HashSet<Account.Id>();
    final ChangeControl control = changeControlFactory.validateFor(changeId);
    final ReviewerResult result = new ReviewerResult();
    for (final String reviewer : reviewers) {
        final Account account = accountResolver.find(reviewer);
        if (account == null) {
            AccountGroup group = groupCache.get(new AccountGroup.NameKey(reviewer));
            if (group == null) {
                result.addError(new ReviewerResult.Error(ReviewerResult.Error.Type.REVIEWER_NOT_FOUND, reviewer));
                continue;
            }
            if (!isLegalReviewerGroup(group.getGroupUUID())) {
                result.addError(new ReviewerResult.Error(ReviewerResult.Error.Type.GROUP_NOT_ALLOWED, reviewer));
                continue;
            }
            final Set<Account> members = groupMembersFactory.create().listAccounts(group.getGroupUUID(), control.getProject().getNameKey());
            if (members == null || members.size() == 0) {
                result.addError(new ReviewerResult.Error(ReviewerResult.Error.Type.GROUP_EMPTY, reviewer));
                continue;
            }
            // if maxAllowed is set to 0, it is allowed to add any number of
            // reviewers
            final int maxAllowed = cfg.getInt("addreviewer", "maxAllowed", DEFAULT_MAX_REVIEWERS);
            if (maxAllowed > 0 && members.size() > maxAllowed) {
                result.setMemberCount(members.size());
                result.setAskForConfirmation(false);
                result.addError(new ReviewerResult.Error(ReviewerResult.Error.Type.GROUP_HAS_TOO_MANY_MEMBERS, reviewer));
                continue;
            }
            // if maxWithoutCheck is set to 0, we never ask for confirmation
            final int maxWithoutConfirmation = cfg.getInt("addreviewer", "maxWithoutConfirmation", DEFAULT_MAX_REVIEWERS_WITHOUT_CHECK);
            if (!confirmed && maxWithoutConfirmation > 0 && members.size() > maxWithoutConfirmation) {
                result.setMemberCount(members.size());
                result.setAskForConfirmation(true);
                result.addError(new ReviewerResult.Error(ReviewerResult.Error.Type.GROUP_HAS_TOO_MANY_MEMBERS, reviewer));
                continue;
            }
            for (final Account member : members) {
                if (member.isActive()) {
                    final IdentifiedUser user = identifiedUserFactory.create(member.getId());
                    // Does not account for draft status as a user might want to let a
                    // reviewer see a draft.
                    if (control.forUser(user).isRefVisible()) {
                        reviewerIds.add(member.getId());
                    }
                }
            }
            continue;
        }
        if (!account.isActive()) {
            result.addError(new ReviewerResult.Error(ReviewerResult.Error.Type.ACCOUNT_INACTIVE, formatUser(account, reviewer)));
            continue;
        }
        final IdentifiedUser user = identifiedUserFactory.create(account.getId());
        // Does not account for draft status as a user might want to let a
        // reviewer see a draft.
        if (!control.forUser(user).isRefVisible()) {
            result.addError(new ReviewerResult.Error(ReviewerResult.Error.Type.CHANGE_NOT_VISIBLE, formatUser(account, reviewer)));
            continue;
        }
        reviewerIds.add(account.getId());
    }
    if (reviewerIds.isEmpty()) {
        return result;
    }
    // Add the reviewers to the database
    // 
    final Set<Account.Id> added = new HashSet<Account.Id>();
    final List<PatchSetApproval> toInsert = new ArrayList<PatchSetApproval>();
    final PatchSet.Id psid = control.getChange().currentPatchSetId();
    for (final Account.Id reviewer : reviewerIds) {
        if (!exists(psid, reviewer)) {
            // This reviewer has not entered an approval for this change yet.
            // 
            final PatchSetApproval myca = dummyApproval(control.getChange(), psid, reviewer);
            toInsert.add(myca);
            added.add(reviewer);
        }
    }
    db.patchSetApprovals().insert(toInsert);
    // Email the reviewers
    // 
    // The user knows they added themselves, don't bother emailing them.
    added.remove(currentUser.getAccountId());
    if (!added.isEmpty()) {
        final AddReviewerSender cm;
        cm = addReviewerSenderFactory.create(control.getChange());
        cm.setFrom(currentUser.getAccountId());
        cm.addReviewers(added);
        cm.send();
    }
    return result;
</td> </tr></table></body></html>