<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>2836</td> <td>-1422650509</td><td>apache/camel</td><td>Henryk Konsek</td><td>0c401b9fba53837bdea3dc486880dd0e0c6e2d6f</td> <td>None</td> <td>probably shutting down, so forget subscription</td> <td>SATD_ADDED</td> <td>subscribe(String, SalesforceConsumer)</td> <td>public void subscribe(final String topicName, final SalesforceConsumer consumer) throws CamelException</td> <td>
    // create subscription for consumer
    final String channelName = getChannelName(topicName);
    // channel message listener
    LOG.info("Subscribing to channel {}...", channelName);
    final ClientSessionChannel.MessageListener listener = new ClientSessionChannel.MessageListener() {

        @Override
        public void onMessage(ClientSessionChannel channel, Message message) {
            LOG.debug("Received Message: {}", message);
            // convert CometD message to Camel Message
            consumer.processMessage(channel, message);
        }
    };
    final ClientSessionChannel clientChannel = client.getChannel(channelName);
    // listener for subscribe error
    final CountDownLatch latch = new CountDownLatch(1);
    final String[] subscribeError = { null };
    final ClientSessionChannel.MessageListener subscriptionListener = new ClientSessionChannel.MessageListener() {

        public void onMessage(ClientSessionChannel channel, Message message) {
            LOG.debug("[CHANNEL:META_SUBSCRIBE]: {}", message);
            final String subscribedChannelName = message.get(SUBSCRIPTION_FIELD).toString();
            if (channelName.equals(subscribedChannelName)) {
                if (!message.isSuccessful()) {
                    String error = (String) message.get(ERROR_FIELD);
                    if (error != null) {
                        subscribeError[0] = error;
                    }
                } else {
                    // remember subscription
                    LOG.info("Subscribed to channel {}", subscribedChannelName);
                }
                latch.countDown();
            }
        }
    };
    client.getChannel(META_SUBSCRIBE).addListener(subscriptionListener);
    try {
        clientChannel.subscribe(listener);
        // confirm that a subscription was created
        try {
            if (!latch.await(CHANNEL_TIMEOUT, SECONDS)) {
                String message;
                if (subscribeError[0] != null) {
                    message = String.format("Error subscribing to topic %s: %s", topicName, subscribeError[0]);
                } else {
                    message = String.format("Timeout error subscribing to topic %s after %s seconds", topicName, CHANNEL_TIMEOUT);
                }
                throw new CamelException(message);
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        // probably shutting down, so forget subscription
        }
        listenerMap.put(consumer, listener);
    } finally {
        client.getChannel(META_SUBSCRIBE).removeListener(subscriptionListener);
    }
</td> </tr></table></body></html>