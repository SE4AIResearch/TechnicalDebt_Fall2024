<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>2217</td> <td>-1422650877</td><td>apache/camel</td><td>Claus Ibsen</td><td>dff07983b7081be3b31d5fb7c74b734044b844be</td> <td>None</td> <td>sending to d should be a miss as this is the first time</td> <td>SATD_ADDED</td> <td>testManageProducerCache()</td> <td>public void testManageProducerCache() throws Exception</td> <td>
    getMockEndpoint("mock:a").expectedMessageCount(1);
    getMockEndpoint("mock:b").expectedMessageCount(1);
    getMockEndpoint("mock:c").expectedMessageCount(1);
    template.sendBodyAndHeader("direct:start", "Hello World", "foo", "mock:a");
    template.sendBodyAndHeader("direct:start", "Hello World", "foo", "mock:b");
    template.sendBodyAndHeader("direct:start", "Hello World", "foo", "mock:c");
    assertMockEndpointsSatisfied();
    // get the stats for the route
    MBeanServer mbeanServer = getMBeanServer();
    Set<ObjectName> set = mbeanServer.queryNames(new ObjectName("*:type=services,*"), null);
    assertEquals(7, set.size());
    List<ObjectName> list = new ArrayList<ObjectName>(set);
    ObjectName on = null;
    for (ObjectName name : list) {
        if (name.getCanonicalName().contains("ProducerCache")) {
            on = name;
            break;
        }
    }
    assertNotNull("Should have found ProducerCache", on);
    Integer max = (Integer) mbeanServer.getAttribute(on, "MaximumCacheSize");
    assertEquals(1000, max.intValue());
    Integer current = (Integer) mbeanServer.getAttribute(on, "Size");
    assertEquals(3, current.intValue());
    // since we only send 1 message to each of the 3, we will have 0 hits and 3 misses
    Long hits = (Long) mbeanServer.getAttribute(on, "Hits");
    assertEquals(0, hits.longValue());
    Long misses = (Long) mbeanServer.getAttribute(on, "Misses");
    assertEquals(3, misses.longValue());
    // now send a message to a and b so we have 2 hits
    // -----------------------------------------------
    resetMocks();
    getMockEndpoint("mock:a").expectedMessageCount(1);
    getMockEndpoint("mock:b").expectedMessageCount(1);
    template.sendBodyAndHeader("direct:start", "Bye World", "foo", "mock:a");
    template.sendBodyAndHeader("direct:start", "Bye World", "foo", "mock:b");
    assertMockEndpointsSatisfied();
    // since we only send 1 message to each of the 3, we will have 0 hits and 3 misses
    hits = (Long) mbeanServer.getAttribute(on, "Hits");
    assertEquals(2, hits.longValue());
    misses = (Long) mbeanServer.getAttribute(on, "Misses");
    assertEquals(3, misses.longValue());
    // and send to mock:d to have another miss
    // ---------------------------------------
    resetMocks();
    getMockEndpoint("mock:d").expectedMessageCount(1);
    template.sendBodyAndHeader("direct:start", "Hi World", "foo", "mock:d");
    assertMockEndpointsSatisfied();
    // sending to d should be a miss as this is the first time
    hits = (Long) mbeanServer.getAttribute(on, "Hits");
    assertEquals(2, hits.longValue());
    misses = (Long) mbeanServer.getAttribute(on, "Misses");
    assertEquals(4, misses.longValue());
    // reset statistics
    // ----------------
    mbeanServer.invoke(on, "resetStatistics", null, null);
    hits = (Long) mbeanServer.getAttribute(on, "Hits");
    assertEquals(0, hits.longValue());
    misses = (Long) mbeanServer.getAttribute(on, "Misses");
    assertEquals(0, misses.longValue());
</td> </tr></table></body></html>