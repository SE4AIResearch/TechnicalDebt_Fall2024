<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>5362</td> <td>-1009652364</td><td>apache/hadoop</td><td>Eli Collins</td><td>a196766ea07775f18ded69bd9e8d239f8cfd3ccc</td> <td>None</td> <td>Fix the filesystem by moving corrupted files to lost+found</td> <td>SATD_ADDED</td> <td>testFsckMove()</td> <td>public void testFsckMove() throws Exception</td> <td>
    DFSTestUtil util = new DFSTestUtil("TestFsck", 5, 3, 8 * 1024);
    MiniDFSCluster cluster = null;
    FileSystem fs = null;
    try {
        Configuration conf = new HdfsConfiguration();
        conf.setLong(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY, 10000L);
        conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY, 1);
        cluster = new MiniDFSCluster.Builder(conf).numDataNodes(4).build();
        String topDir = "/srcdat";
        fs = cluster.getFileSystem();
        cluster.waitActive();
        util.createFiles(fs, topDir);
        util.waitReplication(fs, topDir, (short) 3);
        String outStr = runFsck(conf, 0, true, "/");
        assertTrue(outStr.contains(NamenodeFsck.HEALTHY_STATUS));
        // Corrupt a block by deleting it
        String[] fileNames = util.getFileNames(topDir);
        DFSClient dfsClient = new DFSClient(new InetSocketAddress("localhost", cluster.getNameNodePort()), conf);
        ExtendedBlock block = dfsClient.getNamenode().getBlockLocations(fileNames[0], 0, Long.MAX_VALUE).get(0).getBlock();
        for (int i = 0; i < 4; i++) {
            File blockFile = MiniDFSCluster.getBlockFile(i, block);
            if (blockFile != null && blockFile.exists()) {
                assertTrue(blockFile.delete());
            }
        }
        // We excpect the filesystem to be corrupted
        outStr = runFsck(conf, 1, false, "/");
        while (!outStr.contains(NamenodeFsck.CORRUPT_STATUS)) {
            try {
                Thread.sleep(100);
            } catch (InterruptedException ignore) {
            }
            outStr = runFsck(conf, 1, false, "/");
        }
        // Fix the filesystem by moving corrupted files to lost+found
        outStr = runFsck(conf, 1, true, "/", "-move");
        assertTrue(outStr.contains(NamenodeFsck.CORRUPT_STATUS));
        // Check to make sure we have healthy filesystem
        outStr = runFsck(conf, 0, true, "/");
        assertTrue(outStr.contains(NamenodeFsck.HEALTHY_STATUS));
        util.cleanup(fs, topDir);
        if (fs != null) {
            try {
                fs.close();
            } catch (Exception e) {
            }
        }
        cluster.shutdown();
    } finally {
        if (fs != null) {
            try {
                fs.close();
            } catch (Exception e) {
            }
        }
        if (cluster != null) {
            cluster.shutdown();
        }
    }
</td> </tr></table></body></html>