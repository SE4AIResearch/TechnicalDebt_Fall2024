<html><head>
<style> table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}th {
  background: lightblue;
}</style>
</head> <body><h1>SATD</h1><table><tr><th>satd id</th> <th>satd instance id</th>  <th>project</th> <th>committer name </th> <th> Commit Hash</th> <th>old comment</th> <th>New Comment</th> <th>resolution</th> <th>Method Signature</th> <th>Method Declaration</th> <th>Method Body</th> </tr><tr><td>4017</td> <td>1242677680</td><td>GerritCodeReview/gerrit</td><td>Shawn O. Pearce</td><td>01c34175990d3b0bcf213dab47039c5754f3ba0c</td> <td>None</td> <td>Insert any approval I haven't earlier recorded, using the
absolute maximum value, ignoring permissions. It truncates
at display time and when the issue is closed.
</td> <td>SATD_ADDED</td> <td>appendPatchSet(Change.Id, ReceiveCommand)</td> <td>private void appendPatchSet(final Change.Id changeId, final ReceiveCommand cmd) throws IOException, OrmException</td> <td>
    final RevCommit c = rp.getRevWalk().parseCommit(cmd.getNewId());
    if (!validCommitter(cmd, c)) {
        return;
    }
    final Account.Id me = userAccount.getId();
    final PatchSet ps = db.run(new OrmRunnable<PatchSet, ReviewDb>() {

        public PatchSet run(final ReviewDb db, final Transaction txn, final boolean isRetry) throws OrmException {
            final Change change;
            if (isRetry) {
                change = db.changes().get(changeId);
                if (change == null) {
                    reject(cmd, "change " + changeId.get() + " not found");
                    return null;
                }
                if (change.getStatus().isClosed()) {
                    reject(cmd, "change " + changeId.get() + " closed");
                    return null;
                }
            } else {
                change = changeCache.get(changeId);
            }
            final PatchSet ps = new PatchSet(change.newPatchSetId());
            PatchSetImporter imp = new PatchSetImporter(db, repo, c, ps, true);
            imp.setTransaction(txn);
            try {
                imp.run();
            } catch (IOException e) {
                throw new OrmException(e);
            }
            Set<ApprovalCategory.Id> have = new HashSet<ApprovalCategory.Id>();
            for (ChangeApproval a : db.changeApprovals().byChange(change.getId())) {
                if (me.equals(a.getAccountId())) {
                    // Leave my own approvals alone.
                    // 
                    have.add(a.getCategoryId());
                } else if (a.getValue() > 0) {
                    a.clear();
                    db.changeApprovals().update(Collections.singleton(a), txn);
                }
            }
            for (final ApprovalType t : Common.getGerritConfig().getApprovalTypes()) {
                final ApprovalCategoryValue max = t.getMax();
                final ApprovalCategory.Id catId = t.getCategory().getId();
                if (!have.contains(catId) && max != null) {
                    // Insert any approval I haven't earlier recorded, using the
                    // absolute maximum value, ignoring permissions. It truncates
                    // at display time and when the issue is closed.
                    // 
                    db.changeApprovals().insert(Collections.singleton(new ChangeApproval(new ChangeApproval.Key(change.getId(), me, catId), max.getValue())), txn);
                }
            }
            final ChangeMessage msg = new ChangeMessage(new ChangeMessage.Key(change.getId(), ChangeUtil.messageUUID(db)), me);
            msg.setMessage("Uploaded patch set " + ps.getPatchSetId() + ".");
            db.changeMessages().insert(Collections.singleton(msg), txn);
            change.setStatus(Change.Status.NEW);
            change.setCurrentPatchSet(imp.getPatchSetInfo());
            change.updated();
            db.changes().update(Collections.singleton(change), txn);
            return ps;
        }
    });
    if (ps != null) {
        final RefUpdate ru = repo.updateRef(ps.getRefName());
        ru.setForceUpdate(true);
        ru.setNewObjectId(c);
        ru.update(rp.getRevWalk());
        cmd.setResult(ReceiveCommand.Result.OK);
    }
</td> </tr></table></body></html>